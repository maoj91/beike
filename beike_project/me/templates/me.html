<!DOCTYPE HTML>
<html lang="zh">
<head>
	<meta name="viewport" content = "width=device-width ,  user-scalable=no">
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width ,  user-scalable=no">
    <meta charset="UTF-8">
    <!-- jquery library -->
    <link rel="stylesheet" type="text/css" href="/static/jquery/jquery.mobile-1.4.2.css">
    <script src="/static/jquery/jquery-1.8.3.js "></script>
    <script src="/static/jquery/jquery.mobile-1.4.2.js"></script>

    <!--js library for s3 upload-->
    <script type="text/javascript" src="/static/s3upload.js"></script>
    <script src="/static/exif.js"></script>
    <script src="/static/binaryajax.js"></script>

    <!-- customized css and js -->
    <link rel="stylesheet" type="text/css" href="/static/common.css">
    <script src="/static/me.js"></script>
</head>
<body>
<div data-role="page" id="main-page" data-theme="a">
	<link rel="stylesheet" type="text/css" href="/static/me.css">
	<div data-role="header" data-position="fixed">
	</div>
	<div data-role="content">
        <div id="current_image_div">
        			
        		{% if image %}	
	                {% for key, value in image.items %} 
	                	{% if key == 'image_url' %}
	                		<img id="current_image" src='{{value}}'>
						{% elif key == 'width' %}
						{% elif key == 'height' %}
	                	{% endif %}
	                	
					{% endfor %}    
                {% endif %}

                    <div class="hidden_file">
                        <input type="file" id="image1" data-clear-btn="false" name="image" accept="image/*" onchange="image_s3_upload(this.id,'{{user.wx_id}}');" capture>
                    </div>
                <p id="upload_status">status</p>
                <form action="/me/update_profile_image/" method="post" enctype="multipart/form-data">{% csrf_token %}
					<input type="hidden" id="image_url" name="image_url" value="">
	                <input type="hidden" id="image_width" name="image_width" value="">
	                <input type="hidden" id="image_height" name="image_height" value="">
	                <input type="submit" id="save_image" value="Save">
            	</form>
        </div>


		<div id="error">
			{% if error %}
				<p> {{error}} </p>
			{% endif %}
		</div>
		<div id="profile">
			<p>--------------- 个人资料 ----------------</p>
			<form action="/me/save_profile/" method="post" enctype="multipart/form-data">{% csrf_token %}
				用户名：<input type="text" name="user_name" placeholder={{user.name}} value={{user.name}}></br>
				邮箱：<input type="text" name="user_email" placeholder={{user.email}} value={{user.email}}></br>
				地区：<select name="area_city">
				{% for city in cities %}
					{% if city.name == user.city.name %}
						<option value="{{city.name}}" selected>{{city.name}}</option>
					{% else %}
						<option value="{{city.name}}">{{city.name}}</option>
					{% endif %}
				{% endfor %}
				,</select>

				<select name="area_state">
				{% for state in states %}
					{% if state == user.city.state.name %}
						<option value="{{state.name}}" selected>{{state.name}}</option>
					{% else %}
						<option value="{{state.name}}">{{state.name}}</option>
					{% endif %}
				{% endfor %}
				</select></br>
				<input type="submit" id="save_profile" value="Save">
			</form>
		</div>
		<div id="notification">
			<p>--------------- 通知设置 ----------------</p>
			<form action="/me/save_notification/" method="post" enctype="multipart/form-data">{% csrf_token %}
			当前选项：
				<select name="notification">
				{% for notification in notifications %}
					{% if notification.description == user.notification.description %}
						<option value="{{notification.description}}" selected>{{notification.description}}</option>
					{% else %}
						<option value="{{notification.description}}">{{notification.description}}</option>
					{% endif %}
				{% endfor %}
				</select></br>
			<input type="submit" id="save_notification" value="Save">
		</div>
		<div id="privacy">
			</form>
			<p>--------------- 隐私设置 ----------------</p>
			<form action="/me/save_privacy/" method="post" enctype="multipart/form-data">{% csrf_token %}
				当前选项：<select name="privacy">
				{% for privacy in privacies %}
					{% if privacy.description == user.privacy.description %}
						<option value="{{privacy.description}}" selected>{{privacy.description}}</option>
					{% else %}
						<option value="{{privacy.description}}">{{privacy.description}}</option>
					{% endif %}
				{% endfor %}
				</select></br>
			<input type="submit" id="save_privacy" value="Save">
			</form>
		</div>
	</div>

	<div data-role="footer" data-position="fixed">
    </div>

    <script type="text/javascript">
 //    function displayUserImage(image_info_string) {
	// 	var image_info_list = jQuery.parseJSON(image_info_string);
	//     if (image_info_list.length > 0) {
	//         //only display the first image
	// 		image_info = image_info_list[0];
	// 	} else {
	// 		image_info = undefined;
	// 	}
	// 	var isHorizontal = true;
	// 	if (image_info['height'] > image_info['width']) {
	// 		isHorizontal = false;
	// 	}
	// 	$('#current_image').attr("src",image_info['image_url']);
	// };

        $(document).ready(function() {
            initiatePage();
            // displayUserImage(image_info_string);
        });
    </script>
</div>
</body>
</html>
